var html5Preloader=function(){function e(e,i){for(var t=0;t<i.length;t++)if(i[t]===e)return!0;return!1}function i(e,i){if(e.map)return e.map(i);var t,n=[];for(t=0;t<e.length;t++)n.push(i(e[t]));return n}function t(e,i){return e.bind?e.bind(i):function(){return e.apply(i,arguments)}}function n(e){var i=[].slice.call(arguments,1);setTimeout(function(){e.apply(this,i)},0)}function o(){var e;for(e in o.prototype)o.prototype.hasOwnProperty(e)&&(this[e]=o.prototype[e]);this._listeners={}}function s(i,t){function o(){var e=c.shift();e?new s[e.type](e.path,function(e,i){return u.dom=i&&i.dom,e&&u.alternates.length?o():void t(e,u)}):n(t,Error("No viable alternatives"),null)}if(!(this instanceof s))return new s(i,t);var r,a,d,l,u=this,c=[];if("string"!=typeof i)return void n(t,TypeError("Invalid path"),u);for(r=i.split("*:"),a=r[r[1]?1:0].split("||"),u.id=r[1]?r[0]:a[0],u.alternates=c,r=0;r<a.length;r++)d=a[r].split("."),d=d[d.length-1].toLowerCase(),l=f[d]?f[d].media:e(d,h.imageTypes)?"image":"document",(!f[d]||f[d].supported)&&c.push({type:l,path:a[r]});c.length||c.push({type:l,path:a[r-1]}),o()}function r(e){return function(i,t){function n(){s.onload=s.onerror=null,s.removeEventListener&&s.removeEventListener("canplaythrough",n,!0),t(null,o)}var o=this,s=e();s.addEventListener&&s.addEventListener("canplaythrough",n,!0),s.onload=n,s.onerror=function(e){t(e,o)},o.dom=s,s.src=i,s.load&&s.load()}}function a(){var e=this,i=arguments;return e instanceof a?(e.files=[],a.EventEmitter.call(e),e.loadCallback=t(e.loadCallback,e),void(i.length&&e.loadFiles.apply(e,i))):(e=new a,i.length&&e.loadFiles.apply(e,i),e)}var d="undefined"==typeof XMLHttpRequest?function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(i){}return null}:XMLHttpRequest,l="undefined"!=typeof Audio?function(){return new Audio}:function(){return document.createElement("audio")},u="undefined"!=typeof Video?function(){return new Video}:function(){return document.createElement("video")},c=function(){return new Image},f={oga:{codec:'audio/ogg; codecs="vorbis"',media:"audio"},wav:{codec:'audio/wav; codecs="1"',media:"audio"},webma:{codec:'audio/webm; codecs="vorbis"',media:"audio"},mp3:{codec:'audio/mpeg; codecs="mp3"',media:"audio"},m4a:{codec:'audio/mp4; codecs="mp4a.40.2"',media:"audio"},ogv:{codec:'video/ogg; codecs="theora, vorbis"',media:"video"},webmv:{codec:'video/webm; codecs="vorbis, vp8"',media:"video"},m4v:{codec:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',media:"video"}},h={imageTypes:["jpg","png","jpeg","tiff","gif"]},p="FILE@";return f.ogg=f.oga,o.prototype={_listeners:null,emit:function(e,i){if(i=i||[],this._listeners[e])for(var t=0;t<this._listeners[e].length;t++)this._listeners[e][t].apply(this,i);return this},on:function(e,i){return this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(i),this},off:function(e,i){if(this._listeners[e]){if(!i)return delete this._listeners[e],this;for(var t=0;t<this._listeners[e].length;t++)this._listeners[e][t]===i&&this._listeners[e].splice(t--,1);this._listeners[e].length||delete this._listeners[e]}return this},once:function(e,i){function t(){return this.off(t),i.apply(this,arguments)}return this.on(e,t)}},s.audio=r(l),s.video=r(u),s.image=r(c),s.document=function(e,i){var t=this,o=/(\[(!)?(.+)?\])?$/.exec(e),s=o[3],r=t.dom=new d;return r?(e=e.substr(0,e.length-o[0].length),e+=o[2]?(-1===e.indexOf("?")?"?":"&")+"fobarz="+ +new Date:"",s&&r.overrideMimeType("@"===s?"text/plain; charset=x-user-defined":s),r.onreadystatechange=function(){if(4===r.readyState){t.dom=r.responseXML&&r.responseXML.documentElement?r.responseXML:String(r.responseText||"");200===r.status?i(null,t):i({e:Error("Request failed: "+r.status)},t)}},r.onerror=function(e){i(e,t)},r.open("GET",e,!0),void r.send()):void n(i,Error("No XHR!"),t)},function(){var e,i=l(),t=u();h.audio=!!i.canPlayType,h.video=!!t.canPlayType,h.audioTypes=[],h.videoTypes=[];for(e in f)f.hasOwnProperty(e)&&("video"===f[e].media?(f[e].supported=h.video&&t.canPlayType(f[e].codec))&&h.videoTypes.push(e):"audio"===f[e].media&&(f[e].supported=h.audio&&i.canPlayType(f[e].codec))&&h.audioTypes.push(e))}(),h.audio||(s.audio=function(e,i){n(i,Error("<AUDIO> not supported."),e)}),h.video||(s.video=function(e,i){n(i,Error("<VIDEO> not supported."),e)}),a.prototype={active:!1,files:null,filesLoading:0,filesLoaded:0,loadCallback:function(e,i){this.filesLoaded++,this.emit(e?"error":"fileloaded",e?[e,i]:[i]),this.filesLoading-this.filesLoaded===0&&(this.active=!1,this.emit("finish"),this.filesLoading=0,this.filesLoaded=0)},getFile:function(e){return"undefined"==typeof e?i(this.files,function(e){return e.dom}):"number"==typeof e?this.files[e].dom:"string"==typeof e?this.files[p+e].dom:null},removeFile:function(e){var i,t;switch(typeof e){case"undefined":this.files=[];break;case"number":i=this.files[e],this.files[p+i.id]&&delete this.files[p+i.id],this.files.splice(e,1);break;case"string":for(i=this.files[p+e],i&&delete this.files[p+e],t=0;t<this.files.length;t++)this.files[t]===i&&this.files.splice(t--,1)}},loadFiles:function(){var e,i,t=[].slice.call(arguments);for(e=0;e<t.length;e++)i=a.loadFile(t[e],this.loadCallback),this.files.push(i),this.files[p+i.id]=i,this.filesLoading++;this.active=this.active||!!this.filesLoading},loadFilesArray:function(e){var i,t;new Object;for(i=0;i<e.length;i++)t=a.loadFile(e[i],this.loadCallback),this.files.push(t),this.files[p+t.id]=t,this.filesLoading++;this.active=this.active||!!this.filesLoading},getProgress:function(){return this.filesLoading?this.filesLoaded/this.filesLoading:1}},a.support=h,a.loadFile=s,a.EventEmitter=o,a}();